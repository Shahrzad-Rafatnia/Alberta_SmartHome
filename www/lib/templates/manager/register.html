{% extends 'manager/base.html' %}

{% set title = pageTitle|default('SmartHome Registration!!') %}
{% set registerAction = registerPage|default('/auth/register.php') %}

{% block content %}

<title>{{ title }}</title>
<link rel="stylesheet" type="text/css" href="/css/common.css" />
<link rel="stylesheet" type="text/css" href="/css/register.css" />
<script src="/js/gen_validatorv4.js" type="text/javascript"></script>

<div id="wrapper">
  <div class="middle-content register-box">
    <header>
      <h1>{{ title }}</h1>
    </header>

    <form name="register-form" action="{{ registerAction }}" method="POST">
      <ul class="list-form">
        <li>
          <label for="username">Username</label>
          <input id="username" type="text" name="username" value="{{ account.username }}" autofocus="autofocus" />
          <div id="register-form_username_errorloc" class="error-string"></div>
        </li>

        <li>
          <label for="password">Password</label>
          <input id="password" type="password" name="password" />
          <div id="register-form_password_errorloc" class="error-string"></div>
        </li>
     
        <li>
          <label for="password">Confirm Password</label>
          <input id="conf-password" type="password" name="conf-password" />
          <div id="register-form_conf-password_errorloc" class="error-string"></div>
        </li>
        
        <li>
          <label for="email">Email</label>
          <input id="email" type="email" name="email" value="{{ account.email }}" />
          <div id="register-form_email_errorloc" class="error-string"></div>
        </li>
        
        <li>
          <label for="role">Role</label>
          <select id="role" name="role" value="{{ account.roleID }}" onChange="onRoleChanged(this)">
            <option value="0">SELECT ONE</option>
            <option value="5">Resident</option>
            <option value="4">Engineer</option>
            <option value="3">Manager</option>
            <option value="2">Admin</option>
            <option value="1">Developer</option>
          </select>
          <div id="register-form_role_errorloc" class="error-string"></div>
        </li>
      </ul>

      <div id="residentInfo" style="display:none;">
        <p>Resident Info</p>
        <ul class="list-form">
          <li>
            <label for="name">Resident Name</label>
            <input id="resident-name" type="text" name="resident-name" />
          </li>
          
          <li>
            <label for="resident-room-number">Room Number</label>
            <input id="resident-room-number" type="text"  name="resident-room-number" />
          </li>
          
          <li>
            <label for="building-location">Building Location</label>
            <select id="building-location" name="building-location">
              <option value="NE">NE</option>
              <option value="SW">SW</option>
            </select>
          </li>
        </ul>
      </div>
      
      <input type="submit" name="submit" value="Register"/>
      
      {% if result.isBad %}
      <div class="error-string"><p>Failed to register user. {{ result.friendlyResultOverall }} </p></div>
      {% endif %}
      
      {% if result.isOK %}
      <div class="success-string"><p>Successfully registered user {{ result.UserName }}</p></div>
      {% endif %}

    </form>

    <script type="text/javascript">
      function onRoleChanged(roleElement) {
        
        // TODO: Need to add logic to fully register residents before this is relevant
        /*
        switch (roleElement.value) {
          case "5":
            //document.getElementById("residentInfo").style.display = 'block';
            break;
          default:
            document.getElementById("residentInfo").style.display = 'none';
            break;
        }
        */
      }
        
      var v = new Validator("register-form");
      v.EnableOnPageErrorDisplay();
      v.EnableMsgsTogether();
      v.addValidation("username", "req", "Please enter a username.");
      v.addValidation("username", "maxlen=30", "Max length for username is 30.");
      v.addValidation("password", "req", "Please enter a password.");
      v.addValidation("password", "minlen=8", "Password must be at least 8 characters.");
      v.addValidation("conf-password", "req", "Please confirm your password.");
      v.addValidation("conf-password", "eqelmnt=password","Passwords do not match.");
      v.addValidation("email", "req", "Please enter your email.");
      v.addValidation("email", "email");
      v.addValidation("role","dontselect=0");
    </script>
    
    <nav class="extra-items">
      <ul class="inline-nav-list">
      </ul>
    </nav>
  </div>{# .register-box #}
</div>{# #wrapper #}

{% endblock content %}

